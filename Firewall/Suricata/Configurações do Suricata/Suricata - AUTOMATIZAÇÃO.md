---
tags:
  - suricata
  - redes
  - firewall
  - pfsense
  - automatiza√ß√£o
  - tcc
  - linux
  - faculdade
data cria√ß√£o: 2025-02-04T16:00:00
---
##### Quando instalo e in√≠cio o servi√ßo do Suricata em uma m√°quina Linux, ele vai ficar rodando e colhendo dados da rede at√© que eu pare o servi√ßo dele ou desligue a m√°quina ?

Sim, o **Suricata** continuar√° rodando e coletando dados da rede enquanto a m√°quina estiver ligada e o servi√ßo n√£o for interrompido. No entanto, h√° alguns pontos importantes a considerar se voc√™ pretende deix√°-lo rodando por dois meses ininterruptos:
### üîπ **Fatores a Considerar**

1. **Uso de Disco** üõë
    
    - O Suricata gera **muitos logs** dependendo do volume de tr√°fego da rede. Se n√£o for configurado corretamente, pode encher o disco rapidamente.
    - Verifique o diret√≥rio onde os logs est√£o sendo armazenados (geralmente `/var/log/suricata/`) e implemente um sistema de **rota√ß√£o de logs** com o `logrotate` para evitar problemas.
2. **Uso de Mem√≥ria e CPU** ‚ö°
    
    - Se o tr√°fego da rede for muito alto, o Suricata pode consumir bastante **CPU** e **mem√≥ria**, o que pode afetar o desempenho da m√°quina.
    - √â bom monitorar o uso de recursos com comandos como:
        
        ```bash
        top
        htop
        free -h
        ```
        
3. **Poss√≠veis Rein√≠cios da M√°quina** üîÑ
    
    - Se a m√°quina for reiniciada (por falha de energia, atualiza√ß√µes, etc.), o Suricata pode parar caso n√£o esteja configurado para reiniciar automaticamente.
    - Para garantir que ele sempre inicie com a m√°quina:
        
        ```bash
        sudo systemctl enable suricata
        ```
        
4. **Verifica√ß√£o Regular dos Logs** üìä
    
    - Para evitar perda de dados, √© bom revisar os logs periodicamente:
        
        ```bash
        ls -lh /var/log/suricata/
        tail -f /var/log/suricata/fast.log
        ```
        
    - Voc√™ tamb√©m pode configurar uma ferramenta como **ELK (Elasticsearch, Logstash, Kibana)** para visualizar os logs de forma gr√°fica.

### üîπ **Recomenda√ß√µes para Longo Prazo**

‚úî **Monitoramento autom√°tico:** Use o `cron` ou um script para verificar o espa√ßo em disco e enviar alertas caso fique cheio.  
‚úî **Rota√ß√£o de logs:** Configure o `logrotate` para evitar ac√∫mulo excessivo.  
‚úî **Backups peri√≥dicos:** Se os logs s√£o importantes, fa√ßa backup regular para outra m√°quina ou um storage externo.

Se precisar de ajuda para configurar algo espec√≠fico, me avise! üöÄ

---
##### Me d√™ instru√ß√µes para que eu realize essas recomenda√ß√µes a longo prazo que voc√™ me deu, por favor. Observa√ß√£o: visando que ele vai precisar coletar dados da rede durante dois meses.

√ìtima decis√£o! Para garantir que o **Suricata** colete dados da rede por dois meses sem interrup√ß√µes e sem comprometer o desempenho da m√°quina, siga estas instru√ß√µes detalhadas:
## **1Ô∏è‚É£ Configurar a Rota√ß√£o de Logs para Evitar que o Disco Encha**

O Suricata gera muitos logs, ent√£o vamos configurar o **logrotate** para gerenci√°-los automaticamente.

### **Passos:**

1. Abra o arquivo de configura√ß√£o do **logrotate** para o Suricata:

```bash
sudo nano /etc/logrotate.d/suricata
```

2. Adicione ou modifique o conte√∫do para algo como este:

```ini
/var/log/suricata/*.log {
    daily                    # Roda a rota√ß√£o diariamente
    rotate 60                # Mant√©m logs dos √∫ltimos 60 dias
    compress                 # Comprime logs antigos para economizar espa√ßo
    delaycompress            # A compress√£o ocorre um dia ap√≥s a rota√ß√£o
    missingok                # Se o log n√£o existir, ignora o erro
    notifempty               # N√£o roda a rota√ß√£o se o log estiver vazio
    create 640 suricata suricata # Define as permiss√µes dos novos arquivos de log
    postrotate
        systemctl restart suricata # Reinicia o Suricata ap√≥s rota√ß√£o para garantir continuidade
    endscript
}
```

3. Salve (`CTRL + X`, `Y`, `Enter`) e teste se est√° funcionando:

```bash
sudo logrotate -d /etc/logrotate.d/suricata
```

Isso simula a rota√ß√£o para verificar se h√° erros.

---

## **2Ô∏è‚É£ Monitorar o Espa√ßo em Disco para Evitar Problemas**

Crie um **script autom√°tico** para alert√°-lo caso o disco esteja quase cheio.

### **Passos:**

1. Crie um script para monitorar o espa√ßo em disco:

```bash
sudo nano /usr/local/bin/verifica_disco.sh
```

2. Adicione o seguinte c√≥digo ao arquivo:

```bash
#!/bin/bash
USO=$(df / | awk 'NR==2 {print $5}' | sed 's/%//')
LIMITE=90  # Altere para o percentual que quiser como limite de alerta

if [ "$USO" -gt "$LIMITE" ]; then
    echo "‚ö†Ô∏è ALERTA: O uso do disco est√° em $USO%! Verifique os logs do Suricata." | mail -s "Alerta de Disco Cheio" seu-email@dominio.com
fi
```

3. Salve (`CTRL + X`, `Y`, `Enter`) e d√™ permiss√£o de execu√ß√£o:

```bash
sudo chmod +x /usr/local/bin/verifica_disco.sh
```

4. Configure uma tarefa no **cron** para rodar esse script a cada 6 horas:

```bash
sudo crontab -e
```

5. Adicione esta linha ao final do arquivo:

```bash
0 */6 * * * /usr/local/bin/verifica_disco.sh
```

**Isso verifica o uso do disco a cada 6 horas.**

---

## **3Ô∏è‚É£ Garantir que o Suricata Inicie Automaticamente Ap√≥s Rein√≠cios**

Para evitar interrup√ß√µes no monitoramento, o Suricata deve reiniciar automaticamente quando a m√°quina for ligada.

### **Passos:**

1Ô∏è‚É£ Ative o servi√ßo para iniciar no boot:

```bash
sudo systemctl enable suricata
```

2Ô∏è‚É£ Verifique se est√° ativado corretamente:

```bash
systemctl is-enabled suricata
```

Se a sa√≠da for `enabled`, est√° funcionando.

---

## **4Ô∏è‚É£ Monitorar o Uso de Recursos da M√°quina**

Se o **Suricata** consumir muita CPU/RAM, pode prejudicar a m√°quina. Vamos configurar alertas autom√°ticos.

### **Passos:**

1Ô∏è‚É£ Crie um script para monitorar o uso de CPU e mem√≥ria:

```bash
sudo nano /usr/local/bin/verifica_recursos.sh
```

2Ô∏è‚É£ Adicione este c√≥digo ao arquivo:

```bash
#!/bin/bash
CPU=$(top -bn1 | grep "Cpu(s)" | awk '{print $2 + $4}')
MEM=$(free | awk '/Mem/{print $3/$2 * 100.0}')
LIMITE_CPU=80
LIMITE_MEM=90

if (( $(echo "$CPU > $LIMITE_CPU" | bc -l) )); then
    echo "‚ö†Ô∏è ALERTA: Uso da CPU est√° em ${CPU}%! Verifique o Suricata." | mail -s "Alerta de CPU Alta" seu-email@dominio.com
fi

if (( $(echo "$MEM > $LIMITE_MEM" | bc -l) )); then
    echo "‚ö†Ô∏è ALERTA: Uso de Mem√≥ria est√° em ${MEM}%! Verifique o Suricata." | mail -s "Alerta de Mem√≥ria Alta" seu-email@dominio.com
fi
```

3Ô∏è‚É£ Salve (`CTRL + X`, `Y`, `Enter`) e d√™ permiss√£o de execu√ß√£o:

```bash
sudo chmod +x /usr/local/bin/verifica_recursos.sh
```

4Ô∏è‚É£ Configure o cron para rodar a cada hora:

```bash
sudo crontab -e
```

Adicione esta linha ao final:

```bash
0 * * * * /usr/local/bin/verifica_recursos.sh
```

---

## **5Ô∏è‚É£ Configurar um Backup Regular dos Logs**

Se precisar armazenar logs para auditoria, fa√ßa backup regularmente.

### **Passos:**

1Ô∏è‚É£ Crie um script de backup:

```bash
sudo nano /usr/local/bin/backup_suricata.sh
```

2Ô∏è‚É£ Adicione este c√≥digo ao arquivo:

```bash
#!/bin/bash
DESTINO="/backup/suricata"
mkdir -p $DESTINO
tar -czf $DESTINO/suricata_logs_$(date +%F).tar.gz /var/log/suricata/
```

3Ô∏è‚É£ Salve (`CTRL + X`, `Y`, `Enter`) e d√™ permiss√£o de execu√ß√£o:

```bash
sudo chmod +x /usr/local/bin/backup_suricata.sh
```

4Ô∏è‚É£ Configure o cron para rodar o backup diariamente √†s 2h da manh√£:

```bash
sudo crontab -e
```

Adicione:

```bash
0 2 * * * /usr/local/bin/backup_suricata.sh
```

---

## **6Ô∏è‚É£ (Opcional) Visualizar Logs do Suricata com Kibana + ELK**

Se quiser visualizar os logs em gr√°ficos e dashboards bonitos, pode configurar a stack **ELK (Elasticsearch, Logstash, Kibana)** para ingerir os logs do Suricata. Se quiser seguir por esse caminho, me avise que te passo um guia! üöÄ

---

### **üîπ Resumo do Que Foi Configurado**

‚úÖ **Rota√ß√£o de logs** com `logrotate` para evitar que o disco encha.  
‚úÖ **Monitoramento do uso do disco** com alertas autom√°ticos via e-mail.  
‚úÖ **In√≠cio autom√°tico do Suricata** para que ele volte a rodar ap√≥s um reboot.  
‚úÖ **Monitoramento do uso de CPU e RAM** para evitar lentid√£o na m√°quina.  
‚úÖ **Backup autom√°tico** dos logs para armazenamento seguro.

Com isso, o Suricata pode rodar por **dois meses ou mais sem problemas**! üöÄ

Se precisar de mais alguma personaliza√ß√£o ou ajuda, me avise! üòâ

---
##### **E como posso extrair essas informa√ß√µes ?**

Para **extrair as informa√ß√µes** coletadas pelo **Suricata** e analis√°-las de maneira √∫til, voc√™ pode acessar os logs diretamente, filtrar dados importantes e at√© mesmo usar ferramentas gr√°ficas como **Kibana** ou **Grafana**. Aqui est√£o diferentes formas de extra√ß√£o e an√°lise dos dados:
## **1Ô∏è‚É£ Acessando os Logs do Suricata**

Os logs padr√£o do Suricata geralmente ficam em **`/var/log/suricata/`**.

### **üìå Verificando logs rapidamente**

Para visualizar os eventos em tempo real:

```bash
tail -f /var/log/suricata/fast.log
```

Isso mostra os alertas mais recentes.

Para ver os √∫ltimos **100 eventos** registrados:

```bash
tail -n 100 /var/log/suricata/fast.log
```

Para verificar arquivos JSON (logs mais detalhados):

```bash
cat /var/log/suricata/eve.json | jq
```

‚ö†Ô∏è **Se o comando `jq` n√£o estiver instalado, instale com:**

```bash
sudo apt install jq -y
```

---

## **2Ô∏è‚É£ Filtrando Dados √öteis nos Logs**

Os logs do Suricata podem conter **milhares** de linhas. Para encontrar informa√ß√µes espec√≠ficas, use **filtros**.

### **üîç Encontrando alertas espec√≠ficos**

Se quiser **buscar alertas de um IP espec√≠fico**, use:

```bash
grep "192.168.1.100" /var/log/suricata/fast.log
```

Para **filtrar logs de ataques cr√≠ticos** (exemplo, ataques SQL Injection):

```bash
grep -i "SQL Injection" /var/log/suricata/fast.log
```

Para **contar quantos eventos foram registrados** no log:

```bash
wc -l /var/log/suricata/fast.log
```

Se quiser **visualizar apenas eventos de um per√≠odo**, use:

```bash
grep "2025-02-04" /var/log/suricata/fast.log
```

_(Substitua a data pelo dia desejado)._

---

## **3Ô∏è‚É£ Extraindo Informa√ß√µes para um Arquivo CSV**

Se quiser **exportar logs** para uma planilha e analis√°-los no Excel, fa√ßa assim:

1Ô∏è‚É£ **Extraia os principais alertas para um CSV:**

```bash
awk '{print $1","$2","$3","$4","$5}' /var/log/suricata/fast.log > alertas.csv
```

Depois, voc√™ pode abrir o **`alertas.csv`** no Excel.

2Ô∏è‚É£ **Se estiver usando `eve.json`**, converta JSON para CSV:

```bash
jq -r '. | [.timestamp, .src_ip, .src_port, .dest_ip, .dest_port, .alert.signature] | @csv' /var/log/suricata/eve.json > eventos.csv
```

_(Isso gera um arquivo CSV com Timestamp, IP de Origem, Porta de Origem, IP de Destino, Porta de Destino e a Assinatura do Alerta)._

---

## **4Ô∏è‚É£ Criando um Relat√≥rio Di√°rio Automatizado**

Se quiser **gerar um relat√≥rio** automaticamente com os principais eventos do dia, use este script:

### **üìÑ Criando o Script**

1Ô∏è‚É£ Crie o arquivo de script:

```bash
sudo nano /usr/local/bin/relatorio_suricata.sh
```

2Ô∏è‚É£ Adicione este c√≥digo ao arquivo:

```bash
#!/bin/bash

DATA=$(date +%F)
LOG="/var/log/suricata/eve.json"
SAIDA="/var/log/suricata/relatorio_$DATA.txt"

echo "üìå Relat√≥rio de Seguran√ßa - $DATA" > $SAIDA
echo "----------------------------------" >> $SAIDA
echo "üö® TOP 10 Alertas de Seguran√ßa:" >> $SAIDA
jq -r '.alert.signature' $LOG | sort | uniq -c | sort -nr | head -10 >> $SAIDA
echo "" >> $SAIDA
echo "üîç IPs Mais Frequentes:" >> $SAIDA
jq -r '.src_ip' $LOG | sort | uniq -c | sort -nr | head -10 >> $SAIDA
echo "" >> $SAIDA
echo "üì° Destinos mais acessados:" >> $SAIDA
jq -r '.dest_ip' $LOG | sort | uniq -c | sort -nr | head -10 >> $SAIDA
echo "" >> $SAIDA
echo "‚úÖ Relat√≥rio Gerado em: $SAIDA"
```

3Ô∏è‚É£ Salve (`CTRL + X`, `Y`, `Enter`) e d√™ permiss√£o de execu√ß√£o:

```bash
sudo chmod +x /usr/local/bin/relatorio_suricata.sh
```

4Ô∏è‚É£ Agora, agende para rodar **todo dia √†s 23h** no cron:

```bash
sudo crontab -e
```

Adicione esta linha ao final:

```bash
0 23 * * * /usr/local/bin/relatorio_suricata.sh
```

Agora, todo dia ser√° gerado um relat√≥rio em **`/var/log/suricata/relatorio_YYYY-MM-DD.txt`** com as **principais amea√ßas, IPs suspeitos e tr√°fego anormal**.

---

## **5Ô∏è‚É£ Visualizando os Dados com Ferramentas Gr√°ficas**

Se preferir analisar os dados de forma visual, voc√™ pode integrar o **Suricata** com ferramentas como:

### **üìä Kibana + ELK (Recomendado para Logs Detalhados)**

1. Instale **Elasticsearch**, **Logstash** e **Kibana** no seu servidor.
2. Configure o Logstash para coletar os logs do Suricata.
3. No Kibana, crie dashboards personalizados para visualizar ataques, tr√°fego suspeito e alertas cr√≠ticos.

Se quiser um guia detalhado sobre isso, me avise! üöÄ

### **üìä Grafana + InfluxDB (√ìtimo para Monitoramento de Tr√°fego)**

4. Instale o **InfluxDB** para armazenar os logs.
5. Configure o Suricata para enviar logs em tempo real.
6. No **Grafana**, crie gr√°ficos para monitorar tr√°fego, IPs suspeitos e padr√µes de ataque.

Se quiser um tutorial sobre isso, tamb√©m posso te ajudar! üòÉ

---

## **üîπ Resumo do Que Voc√™ Pode Fazer**

‚úÖ **Acessar logs em tempo real** (`tail -f fast.log`).  
‚úÖ **Filtrar eventos espec√≠ficos** (`grep "IP" fast.log`).  
‚úÖ **Exportar logs para CSV** (`jq -r ... > eventos.csv`).  
‚úÖ **Gerar relat√≥rios autom√°ticos** com os alertas do dia.  
‚úÖ **Configurar dashboards gr√°ficos** com Kibana ou Grafana.

Se precisar de mais algum detalhe ou quiser integrar com alguma ferramenta espec√≠fica, me avise! üöÄ